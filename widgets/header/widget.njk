<!-- ===== SUKOON HEADER ===== -->
{% set showLang = widget.data.show_language_switcher | default(true) %}
{% set showDark = widget.data.show_dark_mode | default(true) %}
{% set rawLang = localization.language | default('ar') %}
{% set currentLang = rawLang if rawLang == 'ar' or rawLang == 'en' else 'ar' %}
{% set availableLangs = localization.availableLanguages | default([]) %}
{% set isSticky = widget.data.sticky | default(true) %}

<header
  id="sukoon-header"
  x-data="{ scrolled: false }"
  x-init="window.addEventListener('scroll', () => { scrolled = window.scrollY > 10 })"
  class="{{ 'sticky top-0' if isSticky else 'relative' }} z-40 w-full transition-all duration-300"
  :class="scrolled ? 'header-scrolled' : ''"
  style="background: var(--color-header); border-bottom: 1px solid var(--color-header-border);"
>
  <div class="container mx-auto px-12 max-lg:px-6 max-sm:px-4">
    <div class="flex items-center justify-between h-16 max-sm:h-14">

      <!-- Logo -->
      <a href="/" class="flex-shrink-0">
        {% if widget.data.header_logo and widget.data.header_logo.fileUrl %}
          <img
            src="{{ widget.data.header_logo.fileUrl }}"
            alt="{{ store.name | default('Sukoon') }}"
            class="h-9 max-sm:h-8 w-auto object-contain dark:brightness-110"
          />
        {% else %}
          <span class="text-lg font-semibold tracking-tight" style="color: var(--color-text-primary);">{{ store.name | default('Sukoon') }}</span>
        {% endif %}
      </a>

      <!-- Center Navigation (Desktop) -->
      <nav class="hidden lg:flex items-center gap-7">
        {% if widget.data.header_menu %}
          {% for item in widget.data.header_menu %}
            <a
              href="{{ item.url | default('#') }}"
              class="relative text-[13px] font-medium tracking-[0.04em] transition-colors duration-200 py-1"
              style="color: var(--color-text-secondary);"
              onmouseenter="this.style.color='var(--color-text-primary)'"
              onmouseleave="this.style.color='var(--color-text-secondary)'"
            >
              {{ item.title }}
            </a>
          {% endfor %}
        {% endif %}
      </nav>

      <!-- Right Actions -->
      <div class="flex items-center gap-1">

        {# â€”â€”â€” Language Switcher (Desktop) â€”â€”â€” #}
        {% if showLang and availableLangs | length > 1 %}
          <div x-data="{ langOpen: false }" class="relative hidden sm:block">
            <button @click="langOpen = !langOpen"
                    @click.outside="langOpen = false"
                    class="flex items-center gap-1.5 h-9 px-2.5 rounded-lg text-[12px] font-medium transition-all duration-200"
                    style="color: var(--color-text-tertiary);"
                    onmouseenter="this.style.color='var(--color-text-primary)'"
                    onmouseleave="this.style.color='var(--color-text-tertiary)'"
                    aria-label="{{ t('common.language') }}">
              <svg class="w-[15px] h-[15px]" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3m0 18c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3m0 0a8.997 8.997 0 017.843 4.582M12 3a8.997 8.997 0 00-7.843 4.582m15.686 0A11.953 11.953 0 0112 10.5c-2.998 0-5.74-1.1-7.843-2.918m15.686 0A8.959 8.959 0 0121 12c0 .778-.099 1.533-.284 2.253m0 0A17.919 17.919 0 0112 16.5c-3.162 0-6.133-.815-8.716-2.247m0 0A9.015 9.015 0 013 12c0-1.605.42-3.113 1.157-4.418"/>
              </svg>
              <span class="uppercase">{{ currentLang }}</span>
              <svg class="w-2.5 h-2.5 transition-transform duration-200" :class="{ 'rotate-180': langOpen }" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"/>
              </svg>
            </button>

            <!-- Dropdown -->
            <div x-show="langOpen"
                 x-transition:enter="transition ease-out duration-200"
                 x-transition:enter-start="opacity-0 scale-95 -translate-y-1"
                 x-transition:enter-end="opacity-100 scale-100 translate-y-0"
                 x-transition:leave="transition ease-in duration-150"
                 x-transition:leave-start="opacity-100 scale-100 translate-y-0"
                 x-transition:leave-end="opacity-0 scale-95 -translate-y-1"
                 class="absolute top-full mt-2 end-0 min-w-[150px] rounded-xl overflow-hidden shadow-lg border"
                 style="background: var(--color-surface); border-color: var(--color-border);">
              {% form 'lang', class='lang-form' %}
                <button type="submit" name="lang" value="ar"
                   class="w-full flex items-center gap-2.5 px-4 py-2.5 text-[13px] font-medium transition-colors duration-150 {{ 'pointer-events-none opacity-50' if currentLang == 'ar' }}"
                   style="color: var(--color-text-primary); background: transparent;"
                   onmouseenter="this.style.background='var(--color-bg-secondary)'"
                   onmouseleave="this.style.background='transparent'">
                  <span class="text-sm">ðŸ‡ªðŸ‡¬</span> <span>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
                  {% if currentLang == 'ar' %}
                    <svg class="w-3.5 h-3.5 ms-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5" style="color: var(--color-accent);">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5"/>
                    </svg>
                  {% endif %}
                </button>
                <button type="submit" name="lang" value="en"
                   class="w-full flex items-center gap-2.5 px-4 py-2.5 text-[13px] font-medium transition-colors duration-150 {{ 'pointer-events-none opacity-50' if currentLang == 'en' }}"
                   style="color: var(--color-text-primary); background: transparent;"
                   onmouseenter="this.style.background='var(--color-bg-secondary)'"
                   onmouseleave="this.style.background='transparent'">
                  <span class="text-sm">ðŸ‡ºðŸ‡¸</span> <span>English</span>
                  {% if currentLang == 'en' %}
                    <svg class="w-3.5 h-3.5 ms-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5" style="color: var(--color-accent);">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5"/>
                    </svg>
                  {% endif %}
                </button>
              {% endform %}
            </div>
          </div>
        {% endif %}

        {# â€”â€”â€” Dark Mode Toggle â€”â€”â€” #}
        {% if showDark %}
          <button
            x-data
            @click="$store.darkMode.toggle()"
            class="w-9 h-9 flex items-center justify-center rounded-lg transition-all duration-200"
            style="color: var(--color-text-tertiary);"
            onmouseenter="this.style.color='var(--color-text-primary)'"
            onmouseleave="this.style.color='var(--color-text-tertiary)'"
            :aria-label="$store.darkMode.on ? '{{ t('common.light_mode') }}' : '{{ t('common.dark_mode') }}'"
          >
            <!-- Sun (shown in dark mode) -->
            <svg x-show="$store.darkMode.on" x-cloak class="w-[18px] h-[18px]" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"/>
            </svg>
            <!-- Moon (shown in light mode) -->
            <svg x-show="!$store.darkMode.on" class="w-[18px] h-[18px]" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z"/>
            </svg>
          </button>
        {% endif %}

        {% if widget.data.show_search %}
          <!-- Search -->
          <button
            onclick="toggleModal('search')"
            aria-label="{{t('blocks.header.search') | default('Search')}}"
            class="w-9 h-9 flex items-center justify-center rounded-lg transition-all duration-200"
            style="color: var(--color-text-tertiary);"
            onmouseenter="this.style.color='var(--color-text-primary)'"
            onmouseleave="this.style.color='var(--color-text-tertiary)'"
          >
            <svg class="w-[18px] h-[18px]" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
              <circle cx="11" cy="11" r="7"/>
              <path d="m20 20-4-4" stroke-linecap="round"/>
            </svg>
          </button>
        {% endif %}

        <!-- Cart -->
        {% if widget.data.show_cart | default(true) %}
        <button
          onclick="toggleModal('cart')"
          aria-label="{{t('blocks.header.cart')}}"
          class="w-9 h-9 flex items-center justify-center rounded-lg transition-all duration-200 relative"
          style="color: var(--color-text-tertiary);"
          onmouseenter="this.style.color='var(--color-text-primary)'"
          onmouseleave="this.style.color='var(--color-text-tertiary)'"
        >
          <svg class="w-[18px] h-[18px]" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
            <path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M3 6h18" stroke-linecap="round"/>
            <path d="M16 10a4 4 0 01-8 0" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          {% if cart.totalQuantity > 0 %}
            <span
              class="absolute top-0.5 end-0.5 w-[15px] h-[15px] rounded-full text-[9px] font-bold flex items-center justify-center text-white bg-accent "
            >
              {{ cart.totalQuantity }}
            </span>
          {% endif %}
        </button>
        {% endif %}

        {# Mobile Menu Button #}
        <button onclick="toggleModal('sidebar')"
                class="lg:hidden w-9 h-9 flex items-center justify-center rounded-lg transition-all duration-200"
                style="color: var(--color-text-tertiary);"
                onmouseenter="this.style.color='var(--color-text-primary)'"
                onmouseleave="this.style.color='var(--color-text-tertiary)'"
                aria-label="{{ t('common.menu') }}">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 9h16.5m-16.5 6.75h16.5"/>
          </svg>
        </button>

      </div>
    </div>
  </div>
</header>

<!-- Mobile Sidebar -->
{% ui "sidebar.njk", menu=widget.data.header_menu, showLang=showLang, showDark=showDark, currentLang=currentLang, availableLangs=availableLangs %}

<!-- Search Popup -->
{% ui "search.njk" %}

<!-- Cart Side Panel -->
{% ui "cart.njk" %}
