{# ===== SUKOON NEWSLETTER ===== #}

{% set bgStyle = widget.data.background_style | default('dark') %}
{% set showNote = widget.data.show_note %}

{# Text customization #}
{% set useCustom = widget.data.custom_colors | default(false) %}
{% set titleSizeVal = widget.data.title_size | default('large') %}
{% if titleSizeVal == 'small' %}
  {% set titleClamp = 'clamp(1.2rem, 2.5vw, 1.5rem)' %}
{% elif titleSizeVal == 'medium' %}
  {% set titleClamp = 'clamp(1.3rem, 3vw, 1.75rem)' %}
{% else %}
  {% set titleClamp = 'clamp(1.5rem, 3vw, 2.25rem)' %}
{% endif %}
{% if useCustom %}
  {% set titleColor = widget.data.title_color | default('#FFFFFF') %}
  {% set subtitleColor = widget.data.subtitle_color | default('#90A4AE') %}
  {% set btnBg = widget.data.button_bg_color | default('#00BCD4') %}
  {% set btnTxt = widget.data.button_text_color | default('#FFFFFF') %}
{% elif bgStyle == 'light' %}
  {% set titleColor = 'var(--color-text-primary)' %}
  {% set subtitleColor = 'var(--color-text-secondary)' %}
  {% set btnBg = 'var(--color-accent)' %}
  {% set btnTxt = '#fff' %}
{% else %}
  {% set titleColor = '#fff' %}
  {% set subtitleColor = 'rgba(255,255,255,0.7)' %}
  {% set btnBg = '#fff' %}
  {% set btnTxt = 'var(--color-text-primary)' %}
{% endif %}

<section id="{{ widget.id }}" class="py-20 max-lg:py-14 max-sm:py-10 relative overflow-hidden"
  {% if bgStyle == 'accent' %}
    style="background: linear-gradient(135deg, var(--color-accent) 0%, var(--color-accent-hover) 100%);"
  {% elif bgStyle == 'light' %}
    style="background: var(--color-section-b);"
  {% else %}
    style="background: linear-gradient(135deg, #1A2C32 0%, #142328 100%);"
  {% endif %}
>

  {# Decorative Elements #}
  {% if bgStyle != 'light' %}
    <div class="absolute -top-24 -end-24 w-80 h-80 rounded-full opacity-[0.06] pointer-events-none" style="background: #fff; filter: blur(50px);"></div>
    <div class="absolute -bottom-20 -start-20 w-64 h-64 rounded-full opacity-[0.04] pointer-events-none" style="background: #fff; filter: blur(40px);"></div>
  {% endif %}

  <div class="container mx-auto px-12 max-lg:px-6 max-sm:px-4 relative z-10">
    <div class="max-w-2xl mx-auto text-center reveal"
         x-data="{ email: '', submitted: false, loading: false }">

      {# ——— Success State ——— #}
      <div x-show="submitted" x-cloak
           x-transition:enter="transition ease-out duration-300"
           x-transition:enter-start="opacity-0 scale-95"
           x-transition:enter-end="opacity-100 scale-100">
        <div class="py-8">
          <div class="w-16 h-16 mx-auto mb-5 rounded-full flex items-center justify-center
                      {% if bgStyle == 'light' %}bg-green-50{% else %}bg-white/15 backdrop-blur-sm{% endif %}">
            <svg class="w-7 h-7 {% if bgStyle == 'light' %}text-green-500{% else %}text-white{% endif %}" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5"/>
            </svg>
          </div>
          <p class="text-lg font-bold {% if bgStyle == 'light' %}text-[var(--color-text-primary)]{% else %}text-white{% endif %}">
            {{ widget.data.success_message | default('تم الاشتراك بنجاح!') }}
          </p>
        </div>
      </div>

      {# ——— Form State ——— #}
      <div x-show="!submitted">

        {# Mail Icon #}
        <div class="w-12 h-12 mx-auto mb-6 max-sm:mb-5 rounded-2xl flex items-center justify-center
                    {% if bgStyle == 'light' %}bg-[var(--color-bg-tertiary)]{% else %}bg-white/10 backdrop-blur-sm{% endif %}">
          <svg class="w-5 h-5 {% if bgStyle == 'light' %}text-[var(--color-text-secondary)]{% else %}text-white/80{% endif %}" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75"/>
          </svg>
        </div>

        {# Title #}
        {% if widget.data.title %}
          <h2 class="font-bold mb-3" style="font-size: {{ titleClamp }}; color: {{ titleColor }};">
            {{ widget.data.title }}
          </h2>
        {% endif %}

        {# Subtitle #}
        {% if widget.data.subtitle %}
          <p class="text-[14px] max-sm:text-[13px] leading-relaxed mb-8 max-sm:mb-6 mx-auto"
             style="max-width: 42ch; color: {{ subtitleColor }};">
            {{ widget.data.subtitle }}
          </p>
        {% endif %}

        {# Form #}
        <form @submit.prevent="loading = true; setTimeout(() => { submitted = true; loading = false; }, 1000);"
              class="flex max-sm:flex-col gap-3 max-w-lg mx-auto">
          <input type="email"
                 x-model="email"
                 required
                 placeholder="{{ widget.data.placeholder | default('أدخل بريدك الإلكتروني') }}"
                 class="flex-1 h-12 max-sm:h-11 px-5 rounded-full text-[13px] outline-none transition-all duration-200
                        {% if bgStyle == 'light' %}bg-transparent text-[var(--color-text-primary)] placeholder-[var(--color-text-tertiary)] border border-[var(--color-border)] focus:bg-white focus:border-[var(--color-accent)]
                        {% else %}bg-transparent text-white placeholder-white/50 border border-white/30 focus:bg-white/[0.1] focus:border-white/50 backdrop-blur-sm{% endif %}">
          <button type="submit"
                  :disabled="loading"
                  class="h-12 max-sm:h-11 px-8 max-sm:px-6 rounded-full text-[13px] font-semibold transition-all duration-300 shrink-0 flex items-center justify-center gap-2 disabled:opacity-60"
                  style="background: {{ btnBg }}; color: {{ btnTxt }};">
            <span x-show="!loading">{{ widget.data.button_text | default('اشترك الآن') }}</span>
            <svg x-show="loading" x-cloak class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
            </svg>
          </button>
        </form>

        {# Privacy Note #}
        {% if showNote and widget.data.note_text %}
          <div class="flex items-center justify-center gap-1.5 mt-5">
            <svg class="w-3 h-3 shrink-0 {% if bgStyle == 'light' %}text-[var(--color-text-tertiary)]{% else %}text-white/40{% endif %}" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 10-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H6.75a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z"/>
            </svg>
            <span class="text-[11px] {% if bgStyle == 'light' %}text-[var(--color-text-tertiary)]{% else %}text-white/40{% endif %}">
              {{ widget.data.note_text }}
            </span>
          </div>
        {% endif %}
      </div>

    </div>
  </div>
</section>
