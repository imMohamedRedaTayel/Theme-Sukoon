{# ===== SUKOON FAQ ACCORDION ===== #}

{% set title = widget.data.title | default('الأسئلة الشائعة') | safe %}
{% set subtitle = widget.data.subtitle | safe %}
{% set layout = widget.data.layout | default('centered') %}
{% set bgStyle = widget.data.background_style | default('white') %}
{% set faqs = widget.blocks | default([]) %}

{# Text customization #}
{% set useCustom = widget.data.custom_colors | default(false) %}
{% set titleSizeVal = widget.data.title_size | default('large') %}
{% if titleSizeVal == 'small' %}
  {% set titleClamp = 'clamp(1.2rem, 2.5vw, 1.5rem)' %}
{% elif titleSizeVal == 'medium' %}
  {% set titleClamp = 'clamp(1.3rem, 3vw, 1.75rem)' %}
{% else %}
  {% set titleClamp = 'clamp(1.5rem, 3vw, 2.25rem)' %}
{% endif %}
{% if useCustom %}
  {% set titleColor = widget.data.title_color | default('#1A2C32') %}
  {% set subtitleColor = widget.data.subtitle_color | default('#546E7A') %}
{% else %}
  {% set titleColor = 'var(--color-text-primary)' %}
  {% set subtitleColor = 'var(--color-accent)' %}
{% endif %}

{% set bgClass = 'bg-[var(--color-section-a)]' %}
{% if bgStyle == 'light' %}
  {% set bgClass = 'bg-[var(--color-section-b)]' %}
{% endif %}

<style>
  #{{ widget.id }} .faq-icon {
    transition: transform 400ms ease;
  }
  #{{ widget.id }} .faq-icon.open {
    transform: rotate(45deg);
  }
  #{{ widget.id }} .faq-item {
    transition: border-color 300ms ease;
  }
  #{{ widget.id }} .faq-item:hover {
    border-color: var(--color-accent);
  }
</style>

<section id="{{ widget.id }}" class="{{ bgClass }} relative overflow-hidden">

  {# Decorative #}
  <div class="absolute -bottom-40 -start-40 w-[500px] h-[500px] rounded-full pointer-events-none"
       style="background: radial-gradient(circle, var(--color-accent) 0%, transparent 60%); opacity: 0.07;"></div>

  <div class="container mx-auto px-12 max-lg:px-6 max-sm:px-4 py-20 max-lg:py-14 max-sm:py-10">

    {% if layout == 'side-by-side' %}
    {# ——— Side by Side Layout ——— #}
    <div class="grid grid-cols-1 lg:grid-cols-5 gap-14 max-lg:gap-8">
      {# Title side #}
      <div class="lg:col-span-2 reveal">
        {% if subtitle %}
          <span class="inline-block text-[11px] font-bold tracking-[0.2em] uppercase mb-4" style="color: {{ subtitleColor }};">{{ subtitle }}</span>
        {% endif %}
        {% if title %}
          <h2 class="mb-4" style="font-size: {{ titleClamp }}; color: {{ titleColor }};">{{ title }}</h2>
        {% endif %}
        <div class="w-12 h-[2px] rounded-full" style="background: var(--color-accent);"></div>
      </div>

      {# FAQ side #}
      <div class="lg:col-span-3 reveal">
        <div x-data="{ activeIdx: null }" class="flex flex-col gap-0">
          {% for block in faqs %}
            <div class="faq-item border-b border-[var(--color-border)]">
              <button @click="activeIdx = activeIdx === {{ loop.index0 }} ? null : {{ loop.index0 }}"
                      class="w-full flex items-center justify-between gap-4 py-5 max-sm:py-4 text-start group cursor-pointer">
                <span class="text-[15px] font-medium leading-relaxed group-hover:text-[var(--color-accent)] transition-colors duration-300">{{ block.data.question }}</span>
                <span class="faq-icon shrink-0 w-6 h-6 flex items-center justify-center rounded-full border border-[var(--color-border)] text-[var(--color-text-secondary)]"
                      :class="{ 'open': activeIdx === {{ loop.index0 }} }">
                  <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/>
                  </svg>
                </span>
              </button>
              <div x-show="activeIdx === {{ loop.index0 }}" x-collapse.duration.400ms>
                <div class="pb-5 max-sm:pb-4 text-[14px] text-[var(--color-text-secondary)] leading-[1.9]">
                  {{ block.data.answer | safe }}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>

    {% else %}
    {# ——— Centered Layout ——— #}
    <div class="max-w-3xl mx-auto">
      {# Header #}
      <div class="text-center mb-12 max-sm:mb-8 reveal">
        {% if subtitle %}
          <span class="inline-block text-[11px] font-bold tracking-[0.2em] uppercase mb-4" style="color: {{ subtitleColor }};">{{ subtitle }}</span>
        {% endif %}
        {% if title %}
          <h2 class="mb-4" style="font-size: {{ titleClamp }}; color: {{ titleColor }};">{{ title }}</h2>
        {% endif %}
        <div class="w-12 h-[2px] rounded-full mx-auto" style="background: var(--color-accent);"></div>
      </div>

      {# FAQ Items #}
      <div x-data="{ activeIdx: null }" class="flex flex-col gap-0 reveal">
        {% for block in faqs %}
          <div class="faq-item border-b border-[var(--color-border)]">
            <button @click="activeIdx = activeIdx === {{ loop.index0 }} ? null : {{ loop.index0 }}"
                    class="w-full flex items-center justify-between gap-4 py-5 max-sm:py-4 text-start group cursor-pointer">
              <span class="text-[15px] font-medium leading-relaxed group-hover:text-[var(--color-accent)] transition-colors duration-300">{{ block.data.question }}</span>
              <span class="faq-icon shrink-0 w-6 h-6 flex items-center justify-center rounded-full border border-[var(--color-border)] text-[var(--color-text-secondary)]"
                    :class="{ 'open': activeIdx === {{ loop.index0 }} }">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15"/>
                </svg>
              </span>
            </button>
            <div x-show="activeIdx === {{ loop.index0 }}" x-collapse.duration.400ms>
              <div class="pb-5 max-sm:pb-4 text-[14px] text-[var(--color-text-secondary)] leading-[1.9]">
                {{ block.data.answer | safe }}
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

  </div>
</section>
